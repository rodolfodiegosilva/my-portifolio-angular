version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "Installing Node.js version 20.11.1"
        - nvm install 20.11.1
        - nvm use 20.11.1
        - echo "Installing project dependencies"
        - npm install --legacy-peer-deps
        - npm install @ngrx/store @ngrx/effects --legacy-peer-deps
        - npm ci --legacy-peer-deps
        - npm install -g @angular/cli
        - npm install dotenv
        - echo "Environment variables:"
        - printenv
        - echo "Running set-env.js script"
        - node set-env.js
    build:
      commands:
        - echo "Building the project with Angular CLI"
        - ng build --configuration production
  artifacts:
    baseDirectory: dist/portfolio/browser
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
  environment:
    variables:
      GITHUB_TOKEN: ${GITHUB_TOKEN}
